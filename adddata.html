<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-PW7HPDW');</script>
	<!-- End Google Tag Manager -->
	<title>LINE Retail Society</title>
	<meta content="" name="description">
	<meta content="" name="keywords">

	<!-- Favicons -->
	<link href="assets/img/favicon.ico" rel="icon">
	<link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

	<!-- Vendor CSS Files -->
	<link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
	<link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
	<link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
	<link href="assets/vendor/venobox/venobox.css" rel="stylesheet">
	<link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
	<link href="assets/vendor/aos/aos.css" rel="stylesheet">

	<!-- Template Main CSS File -->
	<link rel="stylesheet" type="text/css" href="css/ekachon.css">
	<link rel="stylesheet" type="text/css" href="css/button.css">
	<link rel="stylesheet" type="text/css" href="css/app.css">
	<link href="assets/css/style.css" rel="stylesheet">

	<script src="https://static.line-scdn.net/liff/edge/versions/2.8.1/sdk.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-firestore.js"></script>

</head>

<body style="background-color: #0056ff;margin: 0;" >
  <!--
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PW7HPDW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <div class="navbar">
    <div>
      <a href="#" class="active">ttb bank</a>
      <a href="mockrun.html">Mock Run</a>
      <a href="activity.html">กิจกรรม</a>
      <a href="carepack.html">Care Pack</a>
    </div>
  </div>
  -->
  <div class="main">
  <header id="header">
    <div class="container d-flex">
      <div class="logo mr-auto">
        <h4 class="text-light" style="padding-top:8px;"><a href="index.html"><font color="#0056ff"><font color="#009966">LINE</font> <font color="#666666">Retail</font> <font color="#0056ff">So</font><font color="#f68b1f">ciety</font></a></h4>
      </div>
      <!--
      <nav class="nav-menu d-none d-lg-block">
        <ul>
          <li class="active"><a href="index.html">Home</a></li>
          <li><a href="mockrun.html">Mock Run</a></li>
          <li><a href="activity.html">กิจกรรม</a></li>
          <li><a href="carepack.html">Care Pack</a></li>
        </ul>
      </nav>
      -->
    </div>
  </header>


  
<!--
<div style="color:#fff;">
  <img id="pictureUrl" class="imgprofile">
  <p id="displayName"><b>displayName:</b> </p>
  <p id="statusMessage"><b>statusMessage:</b> </p>
  <p><a href="profile.html">Link Profile</a></p>
  <p id="userId"><b>userId:</b> </p>
</div>

-->



  <main id="main">
    <section id="team" class="team section-bg" style="background-color: #0056ff;min-height:450px;">
      <div class="container" id="CheckLogin">
        <div class="section-title" data-aos="fade-up" style="margin-top:10px;">
          <div style="color:#ffffff;font-size:18px;margin-top:-20px;">LINE Retail Society</div>
          <div style="padding:15px 0px 15px 0px;">
            <center>
            <div style="padding:10px;"><img id="pictureUrl" class="imgprofile"></div>
            <div style="color:#ffff00;font-size:16px;"><p id="displayName"></p></div>
            <div class="btn-t2" onclick="ClickCheckLogin()">คลิกที่นี่ ... เพื่อตรวจสอบข้อมูล</div>
            <div style="padding-top:25px;color:#ffffff;">ขอความร่วมมือในการตรวจสอบความถูกต้อง<br>ของข้อมูลของท่านในการเข้าใช้งาน LINE Retail Society<br>*** ขอสงวนสิทธิ์การเข้าใช้งานเฉพาะชาว Retail เท่านั้น ***</div>
            <div><p id="isLoggedIn"></p><p id="userId"></p></div>
            </center>
          </div>
        </div>
      </div>

      <div class="container" id="CheckProfile">
        <div class="section-title" data-aos="fade-up" style="margin-top:-10px;color:#ffffff;">
          <center>
          <div style="font-size: 15px;">ตรวจสอบข้อมูลของคุณ</div>
          <div style="padding:10px;"><img id="pictureUrl1" class="imgprofile-s"></div>
          <div style="color:#ffff00;font-size:16px;"><p id="displayName1"></p></div>
          </center>
          <div style="color:#ccc;text-align: left;padding:5px 30px;margin-top:15px;font-size:13px;">
            <div>ชื่อ-นามสกุล (ภาษาไทย) *</div>
            <div><input type="text" id="fname" placeholder="ชื่อ นามสกุล .."></div>
            <div>รหัสพนักงาน (ttb bank) *</div>
            <div><input type="text" id="empid" placeholder="รหัสพนักงาน .."></div>
            <div>Email@ttbbank.com</div>
            <div><input type="text" id="email" placeholder="ระบุอีเมล์ .."></div>
            <div>โทรศัพท์มือถือ</div>
            <div><input type="text" id="phone" placeholder="โทรศัพท์มือถือ .."></div>
            <div>หน่วยงาน (สาขา + รหัสสาขา)</div>
            <div><input type="text" id="br" placeholder="หน่วยงาน / สาขา (รหัสสาขา) .."></div>
            <div>ที่จัดส่งของรางวัล (ที่ตั้งสาขา)</div>
            <div><textarea id="address" placeholder="ระบุที่จัดส่งของรางวัล .." style="height:100px"></textarea></div>
            <div>ระบุเหตุผลในการเข้าใช้งาน</div>
            <div><textarea id="memo" placeholder="โปรดระบุ .." style="height:100px"></textarea></div>            
            <center><div class="btn-t2" onclick="ClickSaveProfile()">บันทึกรายการ</div></center>
          </div>
        </div>
      </div>

      <div class="container" id="CheckConfirm">
        <div class="section-title" data-aos="fade-up" style="margin-top:10px;">
          <div style="color:#ffffff;font-size:18px;margin-top:-20px;">LINE Retail Society</div>
          <div style="padding:15px 0px 15px 0px;">
            <center>
            <div style="padding:10px;"><img id="pictureUrl1" class="imgprofile-s"></div>
            <div style="color:#ffff00;font-size:16px;"><p id="displayName"></p></div>
            <div class="btn-t2" onclick="ClickCheckLogin()">คลิกที่นี่ ... แก้ไขข้อมูล</div>
            <div style="padding-top:25px;color:#ffffff;">กรุณารอการยืนยันตัวตนภายใน 48 ชั่วโมง<br>ก่อนเข้าทำรายการต่อไป</div>
            <div style="color:#ffffff;"><p id="isLoggedIn"></p><p id="userId"></p></div>
            </center>
          </div>
        </div>
      </div>

    </section>
  </main>
  </div>
  <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

  <!-- Template Main JS File 
  <script src="js/config.js"></script>-->


<script type="text/javascript">
  var firebaseConfig = {
    apiKey: "AIzaSyDfTJJ425U4OY0xac6jdhtSxDeuJ-OF-lE",
    authDomain: "retailproject-6f4fc.firebaseapp.com",
    projectId: "retailproject-6f4fc",
    storageBucket: "retailproject-6f4fc.appspot.com",
    messagingSenderId: "653667385625",
    appId: "1:653667385625:web:a5aed08500de80839f0588",
    measurementId: "G-9SKTRHHSW9"
  };

  firebase.initializeApp(firebaseConfig);
  //firebase.analytics();
  var db = firebase.firestore().collection("CheckProfile");
  document.getElementById('CheckLogin').style.display='block';
  document.getElementById('CheckProfile').style.display='none';
  document.getElementById('CheckConfirm').style.display='none';




    async function main() {
      await liff.init({ liffId: "1655966947-5rJYErwX" });
      document.getElementById("isLoggedIn").append(liff.isLoggedIn());
      if(liff.isLoggedIn()) {
        getUserProfile();
      } else {
        liff.login();
      }
    }
    main()
	//document.getElementById('CheckLogin').style.display='block';
	//document.getElementById('CheckProfile').style.display='none';

    async function getUserProfile() {
      const profile = await liff.getProfile();
      document.getElementById("pictureUrl").src = profile.pictureUrl;
      document.getElementById("pictureUrl1").src = profile.pictureUrl;
      document.getElementById("userId").append(profile.userId);
      document.getElementById("displayName").append(profile.displayName);
      document.getElementById("displayName1").append(profile.displayName);
      aPicture = profile.pictureUrl;
      alineID = profile.userId;
    }


    function openWindow() {
      liff.openWindow({
        url: "https://line.me",
        external: true     
      })
    }

	function ClickCheckLogin() {
		document.getElementById('CheckLogin').style.display='none';
		document.getElementById('CheckProfile').style.display='block';
		document.getElementById('CheckConfirm').style.display='none';
		ReadData(alineID);
	  //GetLineID(alineID);
	}



  //var alineID = "Ua6b6bf745bd9bfd01a180de1a05c23b3";
  //var alineID = "testlineid";
  var aCheck = 0;
  var Eid = "";
  var aStatusConfirm = "";
  var aStatusEdit = "";
  var aPicture = "";

  function ReadData(gLineID) {
    db.where('lineID','==',gLineID).get().then((snapshot)=> {
      snapshot.forEach(doc=> {
        aStatusConfirm = doc.data().statusconfirm;
        aStatusEdit = doc.data().statusedit;
        if(aStatusConfirm==1 && aStatusEdit==1) {
          window.location.href = 'activity.html';
        }        
        //console.log(doc);
        document.getElementById('CheckLogin').style.display='none';
        document.getElementById('CheckProfile').style.display='block';
        document.getElementById('CheckConfirm').style.display='none';
        document.getElementById("fname").value = doc.data().empName;
        document.getElementById("empid").value = doc.data().empID;
        document.getElementById("email").value = doc.data().empEmail
        document.getElementById("phone").value = doc.data().empPhone;
        document.getElementById("br").value = doc.data().empBr;
        document.getElementById("address").value = doc.data().empAddress;
        document.getElementById("memo").value = doc.data().memo;
        //if(aStatusConfirm==1) {
          //$('fname').prop('disabled',false);
          //document.getElementById("fname").classList.add('readonly');
          //document.getElementById("empid").classList.add('readonly');
        //}
        //$('fname').element.classList.add("disabled");
        //$('empid').disabled = true;
        Eid = doc.id;
        aCheck = 1;
      });
      //if(aStatusConfirm=="1") {
      //}
    });
  }




  function ClickSaveProfile() {
	if(document.getElementById("fname").value!="") { var a1 = document.getElementById("fname").value; } else { var a1 = "";}
	if(document.getElementById("empid").value!="") { var a2 = document.getElementById("empid").value; } else { var a2 = "";}
	if(document.getElementById("email").value!="") { var a3 = document.getElementById("email").value; } else { var a3 = "";}
	if(document.getElementById("phone").value!="") { var a4 = document.getElementById("phone").value; } else { var a4 = "";}
	if(document.getElementById("br").value!="") { var a5 = document.getElementById("br").value; } else { var a5 = "";}
	if(document.getElementById("address").value!="") { var a6 = document.getElementById("address").value; } else { var a6 = "";}
	if(document.getElementById("memo").value!="") { var a7 = document.getElementById("memo").value; } else { var a7 = "";}



    if(aCheck==1) {
      db.doc(Eid).update({
      	/*
        empName : document.getElementById("fname").value,
        empID : document.getElementById("empid").value,
        empEmail : document.getElementById("email").value,
        empPhone : document.getElementById("phone").value,
        empBr : document.getElementById("br").value,
        empAddress : document.getElementById("address").value,  
        memo : document.getElementById("memo").value, 
        */   
        empName : a1,
        empID : a2,
        empEmail : a3,
        empPhone : a4,
        empBr : a5,
        empAddress : a6,   
        memo : a7, 
        statusconfirm : "0",
        statusedit : "1"   
      });
    } else {

      db.add({
        lineID : alineID,
        empName : a1,
        empID : a2,
        empEmail : a3,
        empPhone : a4,
        empBr : a5,
        empAddress : a6,   
        memo : a7, 
        empPicture : aPicture;

        /*
        empID : document.getElementById("empid").value,
        empEmail : document.getElementById("email").value,
        empPhone : document.getElementById("phone").value,
        empBr : document.getElementById("br").value,
        empAddress : document.getElementById("address").value,   
        memo : document.getElementById("memo").value, 
        */ 
        statusconfirm : "0",  
        statusedit : "1"   
      });       
    }


    if(aStatusConfirm==0) {
      document.getElementById('CheckLogin').style.display='none';
      document.getElementById('CheckProfile').style.display='none';
      document.getElementById('CheckConfirm').style.display='block';
    } else {
      window.location.href = 'activity.html';
    }

  }


  	//alert(gLineID);

/*

    if (Eid == "") {
      if(Fname!="" && Lname!="" && Age!="") {
        db.add({
          Firstname : Fname,
          Lastname : Lname,
          Age : Age
        });       
      } else {
        alert("Please add First Name bofore Save");
      }
    } else {
      db.doc(Eid).update({
        Firstname : Fname,
        Lastname : Lname,
        Age : Age       
      });
      Eid = "";
      document.getElementById("txtFirstName").value = "";
      document.getElementById("txtLastName").value = "";
      document.getElementById("txtAge").value = "";   }



    var ul = document.getElementById("show");
    var node = document.createElement("LI");
    node.id = "L_"+doc.id;
    var t1 = document.createTextNode(doc.data().Firstname + " | ");
    var t2 = document.createTextNode(doc.data().Lastname + " | ");
    var t3 = document.createTextNode(doc.data().Age);
    node.appendChild(t1);
    node.appendChild(t2);
    node.appendChild(t3);

    //delete
    var b = document.createElement("BUTTON");
    b.innerHTML = "deleted";
    b.addEventListener("click",function(){
      RemoveData(doc.id);
    });
    node.appendChild(b);

    //edit
    var b2 = document.createElement("BUTTON");
    b2.innerHTML = "edit";
    b2.addEventListener("click",function(){
      EditData(
        doc.id,
        doc.data().Firstname,
        doc.data().Lastname,
        doc.data().Age
      );
    });
    node.appendChild(b2);
    ul.appendChild(node);
  }
*/



/*

  function ReadData() {
    db.orderBy("Firstname").onSnapshot(function(snapshot){
      snapshot.docChanges().forEach(function(change){
        if(change.type === "added") {
          ShowData(change.doc);
        }
        if(change.type === "modified") {
          UpdateData(change.doc);
        }
        if(change.type === "removed") {
          var node = document.getElementById("L_"+change.doc.id);
          node.parentNode.removeChild(node);
          //ShowData(change.doc);
        }       
      });
    });
  }



  function ShowData(doc) {
    var ul = document.getElementById("show");
    var node = document.createElement("LI");
    node.id = "L_"+doc.id;
    var t1 = document.createTextNode(doc.data().Firstname + " | ");
    var t2 = document.createTextNode(doc.data().Lastname + " | ");
    var t3 = document.createTextNode(doc.data().Age);
    node.appendChild(t1);
    node.appendChild(t2);
    node.appendChild(t3);

    //delete
    var b = document.createElement("BUTTON");
    b.innerHTML = "deleted";
    b.addEventListener("click",function(){
      RemoveData(doc.id);
    });
    node.appendChild(b);

    //edit
    var b2 = document.createElement("BUTTON");
    b2.innerHTML = "edit";
    b2.addEventListener("click",function(){
      EditData(
        doc.id,
        doc.data().Firstname,
        doc.data().Lastname,
        doc.data().Age
      );
    });
    node.appendChild(b2);
    ul.appendChild(node);
  }


  function UpdateData(doc) {
    var node = document.getElementById("L_" + doc.id);
    node.innerHTML = "";
    var t1 = document.createTextNode(doc.data().Firstname + " | ");
    var t2 = document.createTextNode(doc.data().Lastname + " | ");
    var t3 = document.createTextNode(doc.data().Age);
    node.appendChild(t1);
    node.appendChild(t2);
    node.appendChild(t3);

    //delete
    var b = document.createElement("BUTTON");
    b.innerHTML = "deleted";
    b.addEventListener("click",function(){
      RemoveData(doc.id);
    });
    node.appendChild(b);

    //edit
    var b2 = document.createElement("BUTTON");
    b2.innerHTML = "edit";
    b2.addEventListener("click",function(){
      EditData(
        doc.id,
        doc.data().Firstname,
        doc.data().Lastname,
        doc.data().Age
      );
    });
    node.appendChild(b2);
    //ul.appendChild(node);
  }






  //AddData("steven","wonder",66);
  function AddData(Fname,Lname,Age) {
    if (Eid == "") {
      if(Fname!="" && Lname!="" && Age!="") {
        db.add({
          Firstname : Fname,
          Lastname : Lname,
          Age : Age
        });       
      } else {
        alert("Please add First Name bofore Save");
      }
    } else {
      db.doc(Eid).update({
        Firstname : Fname,
        Lastname : Lname,
        Age : Age       
      });
      Eid = "";
      document.getElementById("txtFirstName").value = "";
      document.getElementById("txtLastName").value = "";
      document.getElementById("txtAge").value = "";   }

  }

  function RemoveData(id) {
    db.doc(id).delete();
  }


  function EditData(id,Fname,Lname,Age) {
    Eid = id;
    document.getElementById("txtFirstName").value = Fname;
    document.getElementById("txtLastName").value = Lname;
    document.getElementById("txtAge").value = Age;

  }

*/

</script>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/jquery/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
  <script src="assets/vendor/jquery-sticky/jquery.sticky.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/venobox/venobox.min.js"></script>
  <script src="assets/vendor/waypoints/jquery.waypoints.min.js"></script>
  <script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/js/main.js"></script>

<!--
  <script src="js/profile.js"></script>

-->

</body>

</html>
